# ðŸ“˜ ON_LM_NewtonClosestUV: Surface Point Inversion

## ë¬¸ì œ ì •ì˜
ì£¼ì–´ì§„ 3D ì  **Q** ì™€ ë§¤ê°œë³€ìˆ˜í™”ëœ ê³¡ë©´

$$
S(u,v): \mathbb{R}^2 \to \mathbb{R}^3
$$

ê°€ ìžˆì„ ë•Œ, ëª©í‘œëŠ” **ê³¡ë©´ ìœ„ì˜ ìµœê·¼ì ‘ì **ì„ ì°¾ëŠ” ê²ƒì´ë‹¤:

$$
(u^*,v^*) = \arg\min_{(u,v)} f(u,v), \quad
$$

$$
f(u,v) = \tfrac{1}{2}\| S(u,v) - Q \|^2
$$



---

## ê·¸ëž˜ë””ì–¸íŠ¸ì™€ í—¤ì„¸ í–‰ë ¬

### ìž”ì°¨ ë²¡í„°
$$
r(u,v) = S(u,v) - Q
$$

### 1ê³„ ë¯¸ë¶„ (Gradient)
$$
\frac{\partial f}{\partial u} = \langle r, S_u \rangle, \quad 
\frac{\partial f}{\partial v} = \langle r, S_v \rangle
$$

ë”°ë¼ì„œ

$$
\nabla f(u,v) =
\begin{bmatrix}
\langle r, S_u \rangle \\
\langle r, S_v \rangle
\end{bmatrix}
$$

### 2ê³„ ë¯¸ë¶„ (Hessian)
$$
\frac{\partial^2 f}{\partial u^2} = \langle S_u, S_u \rangle + \langle r, S_{uu} \rangle
$$
$$
\frac{\partial^2 f}{\partial u \partial v} = \langle S_u, S_v \rangle + \langle r, S_{uv} \rangle
$$
$$
\frac{\partial^2 f}{\partial v^2} = \langle S_v, S_v \rangle + \langle r, S_{vv} \rangle
$$

í—¤ì„¸ í–‰ë ¬:

$$
H =
\begin{bmatrix}
\langle S_u, S_u \rangle + \langle r, S_{uu} \rangle & \langle S_u, S_v \rangle + \langle r, S_{uv} \rangle \\
\langle S_u, S_v \rangle + \langle r, S_{uv} \rangle & \langle S_v, S_v \rangle + \langle r, S_{vv} \rangle
\end{bmatrix}
$$

---

## ë‰´í„´ ì—…ë°ì´íŠ¸

ë‰´í„´ë²•ì€

$$
\Delta =
\begin{bmatrix}
\Delta u \\ \Delta v
\end{bmatrix}
= - H^{-1} \nabla f
$$

ì—…ë°ì´íŠ¸:

$$
u \leftarrow u + \Delta u, \quad v \leftarrow v + \Delta v
$$

---

## Levenbergâ€“Marquardt ê°ì‡ 

í—¤ì„¸ê°€ íŠ¹ì´í•˜ê±°ë‚˜ ìˆ˜ì¹˜ì ìœ¼ë¡œ ë¶ˆì•ˆì •í•˜ë©´ ë°œì‚°í•  ìˆ˜ ìžˆë‹¤.  
ë”°ë¼ì„œ LM ê°ì‡  í•­ì„ ì¶”ê°€:

$$
H' = H + \lambda I
$$

ì—¬ê¸°ì„œ \(\lambda > 0\) ëŠ” ìž‘ì€ ê°’ìœ¼ë¡œ, ìž‘ì€ ê³ ìœ ê°’ì„ ë°€ì–´ì˜¬ë ¤ ì•ˆì •ì„±ì„ ë†’ì¸ë‹¤.

---

## ë¼ì¸ì„œì¹˜ (Backtracking)

ìŠ¤í… í¬ê¸°ë¥¼ ì§ì ‘ ì ìš©í•˜ë©´ overshoot ê°€ëŠ¥ì„±ì´ ìžˆë‹¤.  
ë”°ë¼ì„œ backtracking ìœ¼ë¡œ \(\alpha \in (0,1]\) ë¥¼ ì¤„ì—¬ê°€ë©° ë‹¤ìŒ ì¡°ê±´ ë§Œì¡± ì‹œ ì±„íƒí•œë‹¤:

$$
f(u - \alpha \Delta u, v - \alpha \Delta v) \le f(u,v) - c \alpha \| \nabla f \|^2
$$

ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë‹¨ìˆœížˆ stepì„ Â½ì”© ì¤„ì´ë©° ìž”ì°¨ ê°ì†Œ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.

---

## ì•Œê³ ë¦¬ì¦˜ ìš”ì•½ (ì˜ì‚¬ì½”ë“œ)

```cpp
(u,v) = ì´ˆê¸° ì‹œë“œ (coarse sampling or analytic)
for iter in 0..max_iter:
    S, Su, Sv, Suu, Suv, Svv = Evaluate(surface, u, v)
    r = S - Q

    // gradient
    g = [ dot(r, Su), dot(r, Sv) ]

    // Hessian with LM damping
    H = [[ dot(Su,Su)+dot(r,Suu), dot(Su,Sv)+dot(r,Suv) ],
         [ dot(Su,Sv)+dot(r,Suv), dot(Sv,Sv)+dot(r,Svv) ]]
    H += Î» * I

    Î” = - H^{-1} g

    // line-search
    step = 1.0
    while step > min_step:
        u_new = normalize(u + step*Î”u)
        v_new = normalize(v + step*Î”v)
        if f(u_new,v_new) < f(u,v):
            accept; break
        step *= 0.5

    if |Î”|^2 < tol^2 or ||r||^2 < tol3d^2:
        return (u,v) ì„±ê³µ
